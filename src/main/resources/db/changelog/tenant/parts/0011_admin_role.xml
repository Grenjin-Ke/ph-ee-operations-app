<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
    <changeSet author="fineract" id="1" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM m_appuser WHERE username='recall';
            </sqlCheck>
        </preConditions>
        <insert tableName="m_appuser">
            <column name="id" valueNumeric="4"/>
            <column name="is_deleted" valueBoolean="false"/>
            <column name="office_id" valueNumeric="1"/>
            <column name="staff_id"/>
            <column name="username" value="recall"/>
            <column name="firstname" value="recall"/>
            <column name="lastname" value="recall"/>
            <column name="password"
                    value="{SHA-256}{1}5787039480429368bf94732aacc771cd0a3ea02bcf504ffe1185ab94213bc63a"/>
            <column name="email" value="tamas.szabo+recall@dpc.hu"/>
            <column name="firsttime_login_remaining" valueBoolean="false"/>
            <column name="nonexpired" valueBoolean="true"/>
            <column name="nonlocked" valueBoolean="true"/>
            <column name="nonexpired_credentials" valueBoolean="true"/>
            <column name="enabled" valueBoolean="true"/>
            <column name="last_time_password_updated" valueDate="${current_date}"/>
            <column name="password_never_expires" valueBoolean="false"/>
            <column name="is_self_service_user" valueBoolean="false"/>
            <column name="cannot_change_password"/>
        </insert>
    </changeSet>
    <changeSet author="dgyenizse" id="2" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM m_role WHERE name='Admin';
            </sqlCheck>
        </preConditions>
        <insert tableName="m_role">
            <column name="id" valueNumeric="3"/>
            <column name="name" value="Admin"/>
            <column name="description" value="Administrator"/>
            <column name="is_disabled" valueBoolean="false"/>
        </insert>
    </changeSet>
    <changeSet author="dgyenizse" id="3" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM m_role WHERE name='RecallApprover';
            </sqlCheck>
        </preConditions>
        <insert tableName="m_role">
            <column name="id" valueNumeric="4"/>
            <column name="name" value="RecallApprover"/>
            <column name="description" value="Recall approver"/>
            <column name="is_disabled" valueBoolean="false"/>
        </insert>
    </changeSet>
    <changeSet author="dgyenizse" id="4" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM m_appuser_role WHERE appuser_id=(SELECT id FROM m_appuser WHERE username='mifos') AND role_id=(SELECT id FROM m_role WHERE name='Admin');
            </sqlCheck>
        </preConditions>
        <insert tableName="m_appuser_role">
            <column name="appuser_id"  valueComputed="(SELECT id FROM m_appuser WHERE username='mifos')"/>
            <column name="role_id" valueComputed="(SELECT id FROM m_role WHERE name='Admin')"/>
        </insert>
    </changeSet>
    <changeSet author="dgyenizse" id="5" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM m_appuser_role WHERE appuser_id=(SELECT id FROM m_appuser WHERE username='mifos') AND role_id=(SELECT id FROM m_role WHERE name='RecallApprover');
            </sqlCheck>
        </preConditions>
        <insert tableName="m_appuser_role">
            <column name="appuser_id"  valueComputed="(SELECT id FROM m_appuser WHERE username='mifos')"/>
            <column name="role_id" valueComputed="(SELECT id FROM m_role WHERE name='RecallApprover')"/>
        </insert>
    </changeSet>
    <changeSet author="dgyenizse" id="6" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM m_appuser_role WHERE appuser_id=(SELECT id FROM m_appuser WHERE username='recall') AND role_id=(SELECT id FROM m_role WHERE name='RecallApprover');
            </sqlCheck>
        </preConditions>
        <insert tableName="m_appuser_role">
            <column name="appuser_id"  valueComputed="(SELECT id FROM m_appuser WHERE username='recall')"/>
            <column name="role_id" valueComputed="(SELECT id FROM m_role WHERE name='RecallApprover')"/>
        </insert>
    </changeSet>
</databaseChangeLog>
